mp_setapikey(here("data/raw-private/manifesto_apikey.txt"))

df <- mp_maindataset() %>% 
  filter(countryname %in% c("Austria",
                            "Belgium",
                            "Denmark", "France", "Germany",
                            "Hungary", "Italy", "Netherlands",
                            "Poland", "Portugal", "Romania",
                            "Spain", "Sweden")) %>% 
  mutate(year = as.numeric(format(edate,'%Y'))) %>% 
  filter(year >2010) %>% 
  select(country = countryname,
         year, 
         party_vi = party, partyname,
         rile) 

#df %>% filter(country == "Poland") %>% select(partyname, party_vi) %>% table()
#d1 %>% filter(country == "Poland") %>% select(vote_intention) %>% table()

d1 <- d1 %>% 
  mutate(party_vi = case_when(
    vote_intention == "Miljöpartiet" ~ 11110,
    vote_intention == "Feministiskt Initiativ" ~ 11110,
    vote_intention == "Vänsterpartiet" ~ 11220,
    vote_intention == "Socialdemokraterna" ~ 11320,
    vote_intention == "Liberalerna" ~ 11420,
    vote_intention == "Kristdemokraterna" ~ 11520,
    vote_intention == "Moderaterna" ~ 11620,
    vote_intention == "Sverigedemokraterna" ~ 11710,
    vote_intention == "Centerpartiet" ~ 11810,
    vote_intention == "Liberal Alliance" ~ 13001,
    vote_intention == "Alternativet" ~ 13110,
    vote_intention == "Enhedslisten" ~ 13229,
    vote_intention == "Socialistisk Folkeparti" ~ 13230,
    vote_intention == "Socialdemokratiet" ~ 13320,
    vote_intention == "Radikale Venstre" ~ 13410,
    vote_intention == "Venstre" ~ 13420,
    vote_intention == "Det Konservative Folkeparti" ~ 13620,
    vote_intention == "Dansk Folkeparti" ~ 13720,
    vote_intention == "Nye Borgerlige" ~ 13730,
    vote_intention == "ECOLO" ~ 21111,
    vote_intention == "GROEN" ~ 21112,
    vote_intention == "PTB-PvdA" ~ 21230,
    vote_intention ==  "SP.A" ~ 21321,
    vote_intention ==  "PS" ~ 21322,
    vote_intention ==  "Open VLD" ~ 21421,
    vote_intention ==  "MR" ~ 21426,
    vote_intention ==  "CD&V" ~ 21521,
    vote_intention ==  "CDH" ~ 21522,
    vote_intention ==  "PP" ~ 21710,
    vote_intention ==  "DeFI" ~ 21912,
    vote_intention ==  "N-VA" ~ 21916,
    vote_intention ==  "VB" ~ 21917,
    vote_intention == "LDD" ~ 21430,
    vote_intention ==  "GroenLinks" ~ 22110,
    vote_intention ==  "SP" ~ 22220,
    vote_intention ==  "PVDA" ~ 22320,
    vote_intention ==  "DENK" ~ 22321,
    vote_intention ==  "Volt" ~ 22235,
    vote_intention ==  "Bij1" ~ 22240,
    vote_intention ==  "D66" ~ 22330,
    vote_intention ==  "VVD" ~ 22420,
    vote_intention ==  "CDA" ~ 22521,
    vote_intention ==  "ChristenUnie" ~ 22526,
    vote_intention ==  "PVV" ~ 22722,
    vote_intention ==  "FvD" ~ 22730,
    vote_intention == "JA21" ~ 22731,
    vote_intention == "BBB" ~ 22820,
    vote_intention ==  "PvdD" ~ 22951,
    vote_intention ==  "SGP" ~ 22952,
    vote_intention ==  "50PLUS" ~ 22953,
    vote_intention ==  "Parti de gauche" ~ 31021,
    vote_intention ==  "Europe Écologie Les Verts" ~ 31110,
    vote_intention ==  "Parti communiste français" ~ 31220,
    vote_intention ==  "Parti communiste réunionnais" ~ 31220,
    vote_intention ==  "Parti radical de gauche" ~ 31230,
    vote_intention ==  "Lutte Ouvrièr" ~ 31230,
    vote_intention ==  "Nouveau Parti Anticapitaliste" ~ 31230,
    vote_intention ==  "France Insoumise" ~ 31240,
    vote_intention ==  "Parti socialiste" ~ 31320,
    vote_intention ==  "Générations" ~ 31320,
    vote_intention ==  "Génération Citoyens" ~ 31320,
    vote_intention ==  "Parti radical" ~ 31421,
    vote_intention ==  "La République en marche!" ~ 31425,
    vote_intention ==  "Mouvement Pour la France" ~ 31425,
    vote_intention ==  "Debout la France" ~ 31425,
    vote_intention ==  "Union des démocrates et indépendants" ~ 31430,
    vote_intention ==  "Mouvement démocrate" ~ 31624,
    vote_intention == "Union Populaire Républicaine" ~ 31626,
    vote_intention == "Souveraineté, indépendance et libertés" ~ 31626,
    vote_intention ==  "Les Républicainse" ~ 31626,
    vote_intention ==  "Mouvement Républicain et Citoyen" ~ 31626,
    vote_intention ==  "Alliance centriste" ~ 31630,
    vote_intention ==  "Alliance centriste" ~ 31631,
    vote_intention ==  "Front national" ~ 31720,
    vote_intention ==  "Le Rassemblement" ~ 31720,
    vote_intention ==  "per una Sinistra Rivoluzionaria" ~ 32021,
    vote_intention ==  "Il Popolo della Libertà" ~ 32061,
    vote_intention ==  "Sinistra Ecologia Libertà" ~ 32230,
    vote_intention ==  "Potere al Popolo!" ~ 32230,
    vote_intention ==  "Partito Comunista" ~ 32230,
    vote_intention ==  "Insieme - Italia Europa" ~ 32022,
    vote_intention ==  "Liberi e Uguali" ~ 32031,
    vote_intention ==  "Civica Popolare" ~ 32051,
    vote_intention ==  "Noi con l'Italia UDC" ~ 32055,
    vote_intention ==  "Lega Nord" ~ 32090,
    vote_intention ==  "Partito Democratico" ~ 32440,
    vote_intention ==  "Unione di Centro" ~ 32530,
    vote_intention ==  "Popolo della Famiglia" ~ 32530,
    vote_intention ==  "+Europa" ~ 32451,
    vote_intention ==  "Scelta Civica" ~ 32460,
    vote_intention ==  "Forza Italia" ~ 32610,
    vote_intention ==  "Fratelli d'Italia" ~ 32630,
    vote_intention ==  "Fratelli d'Italia - CN" ~ 32630,
    vote_intention ==  "Italia agli Italiani - FN - FT" ~ 32640,
    vote_intention ==  "CasaPound Italia" ~ 32640,
    vote_intention ==  "Lega" ~ 32720,
    vote_intention ==  "Movimento 5 Stelle" ~ 32956,
    vote_intention ==  "EH Bildu" ~ 33095,
    vote_intention ==  "Unidos Podemos" ~ 33096,
    vote_intention ==  "Compromís" ~ 33098,
    vote_intention ==  "Unidos Podemos" ~ 33210,
    vote_intention ==  "PSOE" ~ 33320,
    vote_intention ==  "Ciudadanos" ~ 33420,
    vote_intention ==  "PP" ~ 33610,
    vote_intention ==  "Unión del Pueblo Navarro" ~ 33610,
    vote_intention ==  "Foro de Ciudadanos / Foro Asturias" ~ 33612,
    vote_intention ==  "Partido Nacionalista Vasco" ~ 33902,
    vote_intention ==  "Esquerra Republicana de Catalunya" ~ 33905,
    vote_intention ==  "Partit Demòcrata Europeu Català" ~ 33905,
    vote_intention ==  "Nueva Canarias" ~ 33907,
    vote_intention ==  "Coalición Canaria" ~ 33907,
    vote_intention ==  "PPD-PSD" ~ 35060,
    vote_intention ==  "Partido Ecologista - Os Verdes" ~ 35110,
    vote_intention ==  "CDU" ~ 35110,
    vote_intention ==  "Pessoas-Animais-Natureza (PAN)" ~ 35120,
    vote_intention ==  "Bloco de Esquerda" ~ 35211,
    vote_intention ==  "PCP" ~ 35220,
    vote_intention ==  "PS" ~ 35311,
    vote_intention ==  "CDS-PP" ~ 35520,
    vote_intention ==  "Gruenen" ~ 41113,
    vote_intention ==  "Linke" ~ 41223,
    vote_intention ==  "SPD" ~ 41320,
    vote_intention ==  "FDP" ~ 41420,
    vote_intention ==  "CDU/CSU" ~ 41521,
    vote_intention ==  "AfD" ~ 41953,
    vote_intention ==  "Gruenen" ~ 42110,
    vote_intention ==  "Liste Pilz" ~ 42120,
    vote_intention ==  "SPO" ~ 42320,
    vote_intention ==  "FPO" ~ 42420,
    vote_intention ==  "NEOS" ~ 42430,
    vote_intention ==  "OVP" ~ 42520,
    vote_intention ==  "LMP" ~ 86110,
    vote_intention ==  "Párbeszéd" ~ 86111,
    vote_intention ==  "MSZP" ~ 86220,
    vote_intention ==  "DK" ~ 86221,
    vote_intention ==  "Fidesz" ~ 86421,
    vote_intention ==  "KDNP" ~ 86421,
    vote_intention ==  "Jobbik" ~ 86710,
    vote_intention ==  "Partia Razem" ~ 92022,
    vote_intention ==  "Zjednoczona Lewica" ~ 92022,
    vote_intention ==  "Wolni i Solidarni (WiS)" ~ 92022,
    vote_intention ==  "Sojusz Lewicy Demokratycznej (SLD)" ~ 92210,
    vote_intention ==  "Unia Europejskich Demokratów (UED)" ~ 92210,
    vote_intention ==  "Solidarna Polska (SP)" ~ 92210,
    vote_intention ==  "Platforma Obywatelska" ~ 92435,
    vote_intention ==  "Kongres Nowej Prawicy (KNP)" ~ 92436,
    vote_intention ==  "Porozumienie" ~ 92436,
    vote_intention ==  "Prawica Rzeczypospolitej" ~ 92436,
    vote_intention ==  "PiS" ~ 92436,
    vote_intention ==  "Unia Polityki Realnej (UPR)" ~ 92436,
    vote_intention ==  "KORWiN" ~ 92436,
    vote_intention ==  "Nowoczesna" ~ 92450,
    vote_intention ==  "Kukiz'15" ~ 92720,
    vote_intention ==  "Wolno?" ~ 92070,
    vote_intention ==  "Polskie Stronnictwo Ludowe" ~ 92811,
    vote_intention ==  "PSD" ~ 93223,
    vote_intention ==  "ALDE" ~ 93420,
    vote_intention ==  "PNL" ~ 93430,
    vote_intention ==  "USR" ~ 93440,
    vote_intention ==  "PMP" ~ 93540,
    vote_intention ==  "UMDR" ~ 93951)) %>% 
  drop_na(vote_intention)

tmp <- left_join(d1, df, by = "party_vi", relationship = "many-to-many")

df2 <- df %>% 
  select(party_vc = party_vi, rile)

tmp <- tmp %>% 
  mutate(party_vc = case_when(
    vote_choice == "Miljöpartiet" ~ 11110,
    vote_choice == "Feministiskt Initiativ" ~ 11110,
    vote_choice == "Vänsterpartiet" ~ 11220,
    vote_choice == "Socialdemokraterna" ~ 11320,
    vote_choice == "Liberalerna" ~ 11420,
    vote_choice == "Kristdemokraterna" ~ 11520,
    vote_choice == "Moderaterna" ~ 11620,
    vote_choice == "Sverigedemokraterna" ~ 11710,
    vote_choice == "Centerpartiet" ~ 11810,
    vote_choice == "Liberal Alliance" ~ 13001,
    vote_choice == "Alternativet" ~ 13110,
    vote_choice == "Enhedslisten" ~ 13229,
    vote_choice == "Socialistisk Folkeparti" ~ 13230,
    vote_choice == "Socialdemokratiet" ~ 13320,
    vote_choice == "Radikale Venstre" ~ 13410,
    vote_choice == "Venstre" ~ 13420,
    vote_choice == "Det Konservative Folkeparti" ~ 13620,
    vote_choice == "Dansk Folkeparti" ~ 13720,
    vote_choice == "Nye Borgerlige" ~ 13730,
    vote_choice == "ECOLO" ~ 21111,
    vote_choice == "GROEN" ~ 21112,
    vote_choice == "PTB-PvdA" ~ 21230,
    vote_choice ==  "SP.A" ~ 21321,
    vote_choice ==  "PS" ~ 21322,
    vote_choice ==  "Open VLD" ~ 21421,
    vote_choice ==  "MR" ~ 21426,
    vote_choice ==  "CD&V" ~ 21521,
    vote_choice ==  "CDH" ~ 21522,
    vote_choice ==  "PP" ~ 21710,
    vote_choice ==  "DeFI" ~ 21912,
    vote_choice ==  "N-VA" ~ 21916,
    vote_choice ==  "VB" ~ 21917,
    vote_choice == "LDD" ~ 21430,
    vote_choice ==  "GroenLinks" ~ 22110,
    vote_choice ==  "SP" ~ 22220,
    vote_choice ==  "PVDA" ~ 22320,
    vote_choice ==  "DENK" ~ 22321,
    vote_choice ==  "Volt" ~ 22235,
    vote_choice ==  "Bij1" ~ 22240,
    vote_choice ==  "D66" ~ 22330,
    vote_choice ==  "VVD" ~ 22420,
    vote_choice ==  "CDA" ~ 22521,
    vote_choice ==  "ChristenUnie" ~ 22526,
    vote_choice ==  "PVV" ~ 22722,
    vote_choice ==  "FvD" ~ 22730,
    vote_choice == "JA21" ~ 22731,
    vote_choice == "BBB" ~ 22820,
    vote_choice ==  "PvdD" ~ 22951,
    vote_choice ==  "SGP" ~ 22952,
    vote_choice ==  "50PLUS" ~ 22953,
    vote_choice ==  "Parti de gauche" ~ 31021,
    vote_choice ==  "Europe Écologie Les Verts" ~ 31110,
    vote_choice ==  "Parti communiste français" ~ 31220,
    vote_choice ==  "Parti communiste réunionnais" ~ 31220,
    vote_choice ==  "Parti radical de gauche" ~ 31230,
    vote_choice ==  "Lutte Ouvrièr" ~ 31230,
    vote_choice ==  "Nouveau Parti Anticapitaliste" ~ 31230,
    vote_choice ==  "France Insoumise" ~ 31240,
    vote_choice ==  "Parti socialiste" ~ 31320,
    vote_choice ==  "Générations" ~ 31320,
    vote_choice ==  "Génération Citoyens" ~ 31320,
    vote_choice ==  "Parti radical" ~ 31421,
    vote_choice ==  "La République en marche!" ~ 31425,
    vote_choice ==  "Mouvement Pour la France" ~ 31425,
    vote_choice ==  "Debout la France" ~ 31425,
    vote_choice ==  "Union des démocrates et indépendants" ~ 31430,
    vote_choice ==  "Mouvement démocrate" ~ 31624,
    vote_choice == "Union Populaire Républicaine" ~ 31626,
    vote_choice == "Souveraineté, indépendance et libertés" ~ 31626,
    vote_choice ==  "Les Républicainse" ~ 31626,
    vote_choice ==  "Mouvement Républicain et Citoyen" ~ 31626,
    vote_choice ==  "Alliance centriste" ~ 31630,
    vote_choice ==  "Alliance centriste" ~ 31631,
    vote_choice ==  "Front national" ~ 31720,
    vote_choice ==  "Le Rassemblement" ~ 31720,
    vote_choice ==  "per una Sinistra Rivoluzionaria" ~ 32021,
    vote_choice ==  "Il Popolo della Libertà" ~ 32061,
    vote_choice ==  "Sinistra Ecologia Libertà" ~ 32230,
    vote_choice ==  "Potere al Popolo!" ~ 32230,
    vote_choice ==  "Partito Comunista" ~ 32230,
    vote_choice ==  "Insieme - Italia Europa" ~ 32022,
    vote_choice ==  "Liberi e Uguali" ~ 32031,
    vote_choice ==  "Civica Popolare" ~ 32051,
    vote_choice ==  "Noi con l'Italia UDC" ~ 32055,
    vote_choice ==  "Lega Nord" ~ 32090,
    vote_choice ==  "Partito Democratico" ~ 32440,
    vote_choice ==  "Unione di Centro" ~ 32530,
    vote_choice ==  "Popolo della Famiglia" ~ 32530,
    vote_choice ==  "+Europa" ~ 32451,
    vote_choice ==  "Scelta Civica" ~ 32460,
    vote_choice ==  "Forza Italia" ~ 32610,
    vote_choice ==  "Fratelli d'Italia" ~ 32630,
    vote_choice ==  "Fratelli d'Italia - CN" ~ 32630,
    vote_choice ==  "Italia agli Italiani - FN - FT" ~ 32640,
    vote_choice ==  "CasaPound Italia" ~ 32640,
    vote_choice ==  "Lega" ~ 32720,
    vote_choice ==  "Movimento 5 Stelle" ~ 32956,
    vote_choice ==  "EH Bildu" ~ 33095,
    vote_choice ==  "Unidos Podemos" ~ 33096,
    vote_choice ==  "Compromís" ~ 33098,
    vote_choice ==  "Unidos Podemos" ~ 33210,
    vote_choice ==  "PSOE" ~ 33320,
    vote_choice ==  "Ciudadanos" ~ 33420,
    vote_choice ==  "PP" ~ 33610,
    vote_choice ==  "Unión del Pueblo Navarro" ~ 33610,
    vote_choice ==  "Foro de Ciudadanos / Foro Asturias" ~ 33612,
    vote_choice ==  "Partido Nacionalista Vasco" ~ 33902,
    vote_choice ==  "Esquerra Republicana de Catalunya" ~ 33905,
    vote_choice ==  "Partit Demòcrata Europeu Català" ~ 33905,
    vote_choice ==  "Nueva Canarias" ~ 33907,
    vote_choice ==  "Coalición Canaria" ~ 33907,
    vote_choice ==  "PPD-PSD" ~ 35060,
    vote_choice ==  "Partido Ecologista - Os Verdes" ~ 35110,
    vote_choice ==  "CDU" ~ 35110,
    vote_choice ==  "Pessoas-Animais-Natureza (PAN)" ~ 35120,
    vote_choice ==  "Bloco de Esquerda" ~ 35211,
    vote_choice ==  "PCP" ~ 35220,
    vote_choice ==  "PS" ~ 35311,
    vote_choice ==  "CDS-PP" ~ 35520,
    vote_choice ==  "Gruenen" ~ 41113,
    vote_choice ==  "Linke" ~ 41223,
    vote_choice ==  "SPD" ~ 41320,
    vote_choice ==  "FDP" ~ 41420,
    vote_choice ==  "CDU/CSU" ~ 41521,
    vote_choice ==  "AfD" ~ 41953,
    vote_choice ==  "Gruenen" ~ 42110,
    vote_choice ==  "Liste Pilz" ~ 42120,
    vote_choice ==  "SPO" ~ 42320,
    vote_choice ==  "FPO" ~ 42420,
    vote_choice ==  "NEOS" ~ 42430,
    vote_choice ==  "OVP" ~ 42520,
    vote_choice ==  "LMP" ~ 86110,
    vote_choice ==  "Párbeszéd" ~ 86111,
    vote_choice ==  "MSZP" ~ 86220,
    vote_choice ==  "DK" ~ 86221,
    vote_choice ==  "Fidesz" ~ 86421,
    vote_choice ==  "KDNP" ~ 86421,
    vote_choice ==  "Jobbik" ~ 86710,
    vote_choice ==  "Partia Razem" ~ 92022,
    vote_choice ==  "Zjednoczona Lewica" ~ 92022,
    vote_choice ==  "Wolni i Solidarni (WiS)" ~ 92022,
    vote_choice ==  "Sojusz Lewicy Demokratycznej (SLD)" ~ 92210,
    vote_choice ==  "Unia Europejskich Demokratów (UED)" ~ 92210,
    vote_choice ==  "Solidarna Polska (SP)" ~ 92210,
    vote_choice ==  "Platforma Obywatelska" ~ 92435,
    vote_choice ==  "Kongres Nowej Prawicy (KNP)" ~ 92436,
    vote_choice ==  "Porozumienie" ~ 92436,
    vote_choice ==  "Prawica Rzeczypospolitej" ~ 92436,
    vote_choice ==  "PiS" ~ 92436,
    vote_choice ==  "Unia Polityki Realnej (UPR)" ~ 92436,
    vote_choice ==  "KORWiN" ~ 92436,
    vote_choice ==  "Nowoczesna" ~ 92450,
    vote_choice ==  "Kukiz'15" ~ 92720,
    vote_choice ==  "Wolno?" ~ 92070,
    vote_choice ==  "Polskie Stronnictwo Ludowe" ~ 92811,
    vote_choice ==  "PSD" ~ 93223,
    vote_choice ==  "ALDE" ~ 93420,
    vote_choice ==  "PNL" ~ 93430,
    vote_choice ==  "USR" ~ 93440,
    vote_choice ==  "PMP" ~ 93540,
    vote_choice ==  "UMDR" ~ 93951)) %>% 
  drop_na(vote_choice)

tmp <- left_join(tmp, df2, by = "party_vc", relationship = "many-to-many")

d1 <- tmp %>% 
  rename(rile_vi = rile.x,
         rile_vc = rile.y,
         country = country.x) %>% 
  select(-country.y, - year, - partyname) %>% 
  distinct(id, .keep_all = T) 

rm(tmp, df, df2)
